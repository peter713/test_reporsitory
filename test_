--COMMENT: HR DD REPORT
--AUTHOR: PL IT
SELECT TO_CHAR(DEP_PLANNED_DATETIME,'YYYY-MM-DD') CREATED_DATE,
       TRIP_LINE_ID,
       NAME,
       BPR_ID,
       TRIP_FILE_ID,
       TOTAL_WEIGHT,
       NB_PIECES,
       (NVL(ALTAJHR_HR_QTY_DAY,0) + NVL(BRIDGESTONE_HR_QTY_DAY,0) + NVL(CATERPILLAR_HR_QTY_DAY,0) + NVL(CAT_LOG_FWD_QTY_DAY,0) + NVL(CAT_LOGISTIKA_TERETI_QTY_DAY,0) + NVL(DUCATI_HR_QTY_DAY,0) + NVL(IVECO_HR_QTY_DAY,0) + NVL(KELLY_HR_QTY_DAY,0) + NVL(KMAG_HR_QTY_DAY,0) + NVL(LMG_HR_QTY_DAY,0) + NVL(MICHELIN_HU_QTY_DAY,0) + NVL(MIHOKOVIC_HR_QTY_DAY,0) + NVL(METALOBOX_HR_QTY_DAY,0) + NVL(STARIMPORT_HR_QTY_DAY,0) + NVL(SKI_SEA_SI_QTY_DAY,0) + NVL(TEKNOX_HR_QTY_DAY,0) + NVL(TOMIC_CO_HR_QTY_DAY,0) + NVL(VALEO_HR_QTY_DAY,0) + NVL(ZED_HR_QTY_DAY,0) + NVL(ZUST_HR_QTY_DAY,0) + NVL(VULKAL_HR_QTY_DAY,0) + NVL(SUZUKI_HR_QTY_DAY,0) + NVL(MAZDA_HR_QTY_DAY,0)+ NVL(SPAN_HR_QTY_DAY,0) + NVL(OTHERS_HR_QTY_DAY,0)) QTY_DAY,
       (NVL(ALTAJHR_HR_QTY_NIGHT,0) + NVL(BRIDGESTONE_HR_QTY_NIGHT,0) + NVL(CATERPILLAR_HR_QTY_NIGHT,0) + NVL(CAT_LOG_FWD_QTY_NIGHT,0) + NVL(CAT_LOGISTIKA_TERETI_QTY_NIGHT,0) + NVL(DUCATI_HR_QTY_NIGHT,0) + NVL(IVECO_HR_QTY_NIGHT,0) + NVL(KELLY_HR_QTY_NIGHT,0) + NVL(KMAG_HR_QTY_NIGHT,0) + NVL(LMG_HR_QTY_NIGHT,0) + NVL(MICHELIN_HU_QTY_NIGHT,0) + NVL(MIHOKOVIC_HR_QTY_NIGHT,0) + NVL(METALOBOX_HR_QTY_NIGHT,0) + NVL(STARIMPORT_HR_QTY_NIGHT,0) + NVL(SKI_SEA_SI_QTY_NIGHT,0) + NVL(TEKNOX_HR_QTY_NIGHT,0) + NVL(TOMIC_CO_HR_QTY_NIGHT,0) + NVL(VALEO_HR_QTY_NIGHT,0) + NVL(ZED_HR_QTY_NIGHT,0) + NVL(ZUST_HR_QTY_NIGHT,0) + NVL(VULKAL_HR_QTY_NIGHT,0) + NVL(SUZUKI_HR_QTY_NIGHT,0) + NVL(MAZDA_HR_QTY_NIGHT,0) + NVL(SPAN_HR_QTY_NIGHT,0) + NVL(OTHERS_HR_QTY_NIGHT,0)) QTY_NIGHT,
       MEANS_TYPE,
       MEANS_ID,
       CASE
         WHEN EURO_EMISSION IS NULL THEN NULL
         ELSE 'Euro ' ||EURO_EMISSION
       END EURO_EMISSION,
       SUPPLIER_ID,
       NB_OF_DEL,
       REALISED_KMS,
       CASH,
       ALTAJHR_HR_QTY,
       ALTAJHR_HR_GRS,
       BRIDGESTONE_HR_QTY,
       BRIDGESTONE_HR_GRS,
       CATERPILLAR_HR_QTY,
       CATERPILLAR_HR_GRS,
       CAT_LOG_FWD_QTY,
       CAT_LOG_FWD_GRS,
       CAT_LOGISTIKA_TERETI_QTY,
       CAT_LOGISTIKA_TERETI_GRS,
       DUCATI_HR_QTY,
       DUCATI_HR_GRS,
       IVECO_HR_QTY,
       IVECO_HR_GRS,
       KELLY_HR_QTY,
       KELLY_HR_GRS,
       KMAG_HR_QTY,
       KMAG_HR_GRS,
       LMG_HR_QTY,
       LMG_HR_GRS,
       MICHELIN_HU_QTY,
       MICHELIN_HU_GRS,
       MIHOKOVIC_HR_QTY,
       MIHOKOVIC_HR_GRS,
       METALOBOX_HR_QTY,
       METALOBOX_HR_GRS,
       STARIMPORT_HR_QTY,
       STARIMPORT_HR_GRS,
       SKI_SEA_SI_QTY,
       SKI_SEA_SI_GRS,
       TEKNOX_HR_QTY,
       TEKNOX_HR_GRS,
       TOMIC_CO_HR_QTY,
       TOMIC_CO_HR_GRS,
       VALEO_HR_QTY,
       VALEO_HR_GRS,
       ZED_HR_QTY,
       ZED_HR_GRS,
       ZUST_HR_QTY,
       ZUST_HR_GRS,
       VULKAL_HR_QTY,
       VULKAL_HR_GRS,
	SUZUKI_HR_QTY,
	SUZUKI_HR_GRS,
       MAZDA_HR_QTY,
       MAZDA_HR_GRS,
       SPAN_HR_QTY,
       SPAN_HR_GRS,
       OTHERS_HR_QTY,
       OTHERS_HR_GRS
FROM (SELECT TP.DEP_PLANNED_DATETIME,
             TP.TRIP_LINE_ID,
             TN.NAME,
             TP.BPR_ID,
             TP.TRIP_FILE_ID,
             TP.TOTAL_WEIGHT,
             TP.NB_PIECES,
             TP.MEANS_TYPE,
             TP.MEANS_ID,
             (SELECT EURO_EMISSION_KIND
              FROM VS_MEANS
              WHERE MEANS_ID = TP.MEANS_ID) EURO_EMISSION,
             TP.SUPPLIER_ID,
             CASE
               WHEN CO.XACCOUNT_ID IN ('ALTAJHR_HR','BRIDGESTONE_HR','CATERPILLAR_HR','CAT_LOG_FWD','CAT_LOGISTIKA_TERETI','DUCATI_HR','IVECO_HR','KELLY_HR','KMAG_HR','LMG_HR','MICHELIN_HU','MIHOKOVIC_HR','METALOBOX_HR','STARIMPORT_HR','SKI_SEA_SI','TEKNOX_HR','TOMIC_CO_HR','VALEO_HR','ZED_HR','ZUST_HR','VULKAL_HR','SUZUKI_HR','MAZDA_HR','SPAN_HR') THEN CO.XACCOUNT_ID
               ELSE 'OTHERS_HR'
             END XACCOUNT_ID,
             TP.NB_OF_DEL,
             TP.REALISED_KMS,
             CO.HU_QTY,
             NVL(CASE WHEN CO.SPR_ID LIKE 'DAY%' THEN CO.HU_QTY ELSE 0 END,0) HU_QTY_DAY,
             NVL(CASE WHEN CO.SPR_ID LIKE 'NIGHT%' THEN CO.HU_QTY ELSE 0 END,0) HU_QTY_NIGHT,
             CO.GRS_WGT,
             (SELECT SUM(FORC_CURVAL)
              FROM VS_RATING
              WHERE RATING_TYPE = 'C'
              AND   TRIP_FILE_FK = TP.PK) CASH
      FROM VS_TRIP_FILE TP
        LEFT JOIN VS_TRIP_LINES TN ON TN.PK = TP.TRIP_LINE_FK
        LEFT JOIN (SELECT DISTINCT /*+ FIRST_ROW(1) */ TRIP_FILE_FK,
                          CUSORD_FK
                   FROM VS_OPS) OP ON TP.PK = OP.TRIP_FILE_FK
        LEFT JOIN VS_CUSORD CO ON OP.CUSORD_FK = CO.PK
      WHERE TRUNC(DEP_PLANNED_DATETIME) BETWEEN TRUNC(SYSDATE,'MONTH') AND TRUNC(SYSDATE) +0.99999
      AND   TP.BPR_ID = 'MILKRUN'
      AND   SUBSTR(TP.TRIP_FILE_ID,0,4) = 'RTHR')
    /*  AND   CO.XACCOUNT_ID IN ('ALTAJHR_HR','BRIDGESTONE_HR','CATERPILLAR_HR','CAT_LOG_FWD','CAT_LOGISTIKA_TERETI','DUCATI_HR','IVECO_HR','KELLY_HR','KMAG_HR','LMG_HR','MICHELIN_HU','MIHOKOVIC_HR','METALOBOX_HR','STARIMPORT_HR','SKI_SEA_SI','TEKNOX_HR','TOMIC_CO_HR','VALEO_HR','ZED_HR','ZUST_HR','VULKAL_HR','SUZUKI_HR','MAZDA_HR','SPAN_HR','OTHERS_HR'))*/ PIVOT (SUM(HU_QTY) AS QTY,SUM(HU_QTY_DAY) AS QTY_DAY,SUM(HU_QTY_NIGHT) AS QTY_NIGHT,SUM(GRS_WGT) AS GRS
     FOR
     XACCOUNT_ID IN ('ALTAJHR_HR' AS ALTAJHR_HR,'BRIDGESTONE_HR' AS BRIDGESTONE_HR,'CATERPILLAR_HR' AS CATERPILLAR_HR,'CAT_LOG_FWD' AS CAT_LOG_FWD,'CAT_LOGISTIKA_TERETI' AS CAT_LOGISTIKA_TERETI,'DUCATI_HR' AS DUCATI_HR,'IVECO_HR' AS IVECO_HR,'KELLY_HR' AS KELLY_HR,'KMAG_HR' AS KMAG_HR,'LMG_HR' AS LMG_HR,'MICHELIN_HU' AS MICHELIN_HU,'MIHOKOVIC_HR' AS MIHOKOVIC_HR,'METALOBOX_HR' AS METALOBOX_HR,'STARIMPORT_HR' AS STARIMPORT_HR,'SKI_SEA_SI' AS SKI_SEA_SI,'TEKNOX_HR' AS TEKNOX_HR,'TOMIC_CO_HR' AS TOMIC_CO_HR,'VALEO_HR' AS VALEO_HR,'ZED_HR' AS ZED_HR,'ZUST_HR' AS ZUST_HR,'VULKAL_HR' AS VULKAL_HR,'SUZUKI_HR' AS SUZUKI_HR,'MAZDA_HR' AS MAZDA_HR,'SPAN_HR' AS SPAN_HR,'OTHERS_HR' AS OTHERS_HR))
ORDER BY 1,
         2
